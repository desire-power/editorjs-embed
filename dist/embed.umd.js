(function(h,d){typeof exports=="object"&&typeof module<"u"?module.exports=d():typeof define=="function"&&define.amd?define(d):(h=typeof globalThis<"u"?globalThis:h||self,h.Embed=d())})(this,function(){"use strict";var _=Object.defineProperty;var k=(h,d,m)=>d in h?_(h,d,{enumerable:!0,configurable:!0,writable:!0,value:m}):h[d]=m;var w=(h,d,m)=>(k(h,typeof d!="symbol"?d+"":d,m),m);const h='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 8L5 12L9 16"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 8L19 12L15 16"/></svg>';function d(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function m(n,i,e){var t,s,r,o,a;i==null&&(i=100);function l(){var u=Date.now()-o;u<i&&u>=0?t=setTimeout(l,i-u):(t=null,e||(a=n.apply(r,s),r=s=null))}var p=function(){r=this,s=arguments,o=Date.now();var u=e&&!t;return t||(t=setTimeout(l,i)),u&&(a=n.apply(r,s),r=s=null),a};return p.clear=function(){t&&(clearTimeout(t),t=null)},p.flush=function(){t&&(a=n.apply(r,s),r=s=null,clearTimeout(t),t=null)},p}m.debounce=m;var y=m;const x=d(y),c=class c{constructor({data:i,api:e,readOnly:t}){this.api=e,this.nodes={wrapper:null,container:null,progress:null,input:null,inputHolder:null},this._data=Object.keys(i).length!==0?i:void 0,this.readOnly=t}set data(i){var t;if(!(i instanceof Object))throw Error("Embed Tool data should be object");this._data=i;const e=this.nodes.wrapper;e&&((t=e.parentNode)==null||t.replaceChild(this.render(),e))}get data(){return this._data}get CSS(){return{baseClass:this.api.styles.block,input:this.api.styles.input,container:"embed-tool",inputEl:"embed-tool__input",inputHolder:"embed-tool__input-holder",inputError:"embed-tool__input-holder--error",linkContent:"embed-tool__content",linkContentRendered:"embed-tool__content--rendered",linkImage:"embed-tool__image",linkTitle:"embed-tool__title",linkDescription:"embed-tool__description",linkText:"embed-tool__anchor",progress:"embed-tool__progress",progressLoading:"embed-tool__progress--loading",progressLoaded:"embed-tool__progress--loaded",caption:"embed-tool__caption",content:"embed-tool__content"}}render(){return this._data?this.nodes.wrapper=this.makeEmbed()??this.make("div",this.CSS.baseClass):(this.nodes.wrapper=this.make("div",this.CSS.baseClass),this.nodes.container=this.make("div",this.CSS.container),this.nodes.inputHolder=this.makeInputHolder(),this.nodes.container.appendChild(this.nodes.inputHolder),this.nodes.wrapper.appendChild(this.nodes.container)),this.nodes.wrapper}makeEmbed(){var o,a;if(this.showProgress(),!this.data||!c.services)return null;const{html:i}=c.services[this.data.service],e=this.make("div",this.CSS.baseClass),t=this.make("div",this.CSS.container),s=document.createElement("template");s.innerHTML=i,(o=s.content.firstChild)==null||o.setAttribute("src",this.data.embed),(a=s.content.firstChild)==null||a.classList.add(this.CSS.content),this.nodes.container=t;const r=this.embedIsReady(this.nodes.container);return s.content.firstChild&&t.appendChild(s.content.firstChild),r.then(()=>{this.hideProgress()}),e.appendChild(t),e}async embedIsReady(i){let t=null;return new Promise(s=>{t=new MutationObserver(x(s,450)),t.observe(i,{childList:!0,subtree:!0})}).then(()=>{t==null||t.disconnect()})}makeInputHolder(){const i=this.make("div",this.CSS.inputHolder);return this.nodes.progress=this.make("label",this.CSS.progress),this.nodes.input=this.make("div",[this.CSS.input,this.CSS.inputEl],{contentEditable:!this.readOnly}),this.nodes.input.dataset.placeholder=this.api.i18n.t("Link"),this.nodes.input.addEventListener("keydown",e=>{const[t,s]=[13,65],r=e.ctrlKey||e.metaKey;switch(e.keyCode){case t:e.preventDefault(),e.stopPropagation(),e.target&&"textContent"in e.target&&typeof e.target.textContent=="string"&&this.setData(e.target.textContent);break;case s:r&&e.target&&"textContent"in e.target&&typeof e.target.textContent=="string"&&this.setData(e.target.textContent);break}}),i.appendChild(this.nodes.progress),i.appendChild(this.nodes.input),i}setData(i){var u,b;if(!c.services)return;const e=(u=Object.entries(c.services).find(([,f])=>f.regex.test(i)))==null?void 0:u[1];if(!e)return;const{regex:t,embedUrl:s,width:r,height:o,id:a=f=>f.shift()}=e,l=(b=t.exec(i))==null?void 0:b.slice(1);if(!l)return;const p=s.replace(/<%= remote_id %>/g,a(l)??"");this.data={service:e.name,source:i,embed:p,width:r,height:o}}static prepare({config:i={}}){const{services:e}=i;if(!e)return;let t=Object.entries(v);const s=Object.entries(e).filter(([,r])=>typeof r=="boolean"&&r===!0).map(([r])=>r);s.length&&(t=t.filter(([r])=>s.includes(r))),c.services=t.reduce((r,[o,a])=>o in r?(r[o]=Object.assign({},r[o],a),r):(r[o]=a,r),{})}static checkServiceConfig(i){const{regex:e,embedUrl:t,html:s,height:r,width:o,id:a}=i;let l=e&&e instanceof RegExp&&t&&typeof t=="string"&&s&&typeof s=="string";return l=l&&(a!==void 0?a instanceof Function:!0),l=l&&(r!==void 0?Number.isFinite(r):!0),l=l&&(o!==void 0?Number.isFinite(o):!0),l}save(){return this.data}static get toolbox(){return{icon:h,title:"Embed"}}showProgress(){var i;(i=this.nodes.progress)==null||i.classList.add(this.CSS.progressLoading)}hideProgress(){return new Promise(i=>{var e,t;(e=this.nodes.progress)==null||e.classList.remove(this.CSS.progressLoading),(t=this.nodes.progress)==null||t.classList.add(this.CSS.progressLoaded),setTimeout(i,500)})}make(i,e,t){const s=document.createElement(i);Array.isArray(e)?s.classList.add(...e):e&&s.classList.add(e);for(const r in t){const o=r,a=t[o];a!==void 0&&(s[o]=a)}return s}static get enableLineBreaks(){return!0}};w(c,"services");let g=c;const v={vimeo:{name:"vimeo",regex:/(?:http[s]?:\/\/)?(?:www.)?(?:player.)?vimeo\.co(?:.+\/([^\/]\d+)(?:#t=[\d]+)?s?$)/,embedUrl:"https://player.vimeo.com/video/<%= remote_id %>?title=0&byline=0",html:'<iframe style="width:100%;" height="320" frameborder="0"></iframe>',height:320,width:580},youtube:{name:"youtube",regex:/(?:https?:\/\/)?(?:www\.)?(?:(?:youtu\.be\/)|(?:youtube\.com)\/(?:v\/|u\/\w\/|embed\/|watch))(?:(?:\?v=)?([^#&?=]*))?((?:[?&]\w*=\w*)*)/,embedUrl:"https://www.youtube.com/embed/<%= remote_id %>",html:'<iframe style="width:100%;" height="320" frameborder="0" allowfullscreen></iframe>',height:320,width:580,id:([n,i])=>{if(!i&&n)return n;const e={start:"start",end:"end",t:"start",time_continue:"start",list:"list"},t=i.slice(1).split("&").map(s=>{const[r,o]=s.split("=");return n?!e[r]||o==="LL"||o.startsWith("RDMM")||o.startsWith("FL")?null:`${e[r]}=${o}`:(n=o,null)}).filter(s=>!!s);return n+"?"+t.join("&")}},coub:{name:"coub",regex:/https?:\/\/coub\.com\/view\/([^\/\?\&]+)/,embedUrl:"https://coub.com/embed/<%= remote_id %>",html:'<iframe style="width:100%;" height="320" frameborder="0" allowfullscreen></iframe>',height:320,width:580},vine:{name:"vine",regex:/https?:\/\/vine\.co\/v\/([^\/\?\&]+)/,embedUrl:"https://vine.co/v/<%= remote_id %>/embed/simple/",html:'<iframe style="width:100%;" height="320" frameborder="0" allowfullscreen></iframe>',height:320,width:580},imgur:{name:"imgur",regex:/https?:\/\/(?:i\.)?imgur\.com.*\/([a-zA-Z0-9]+)(?:\.gifv)?/,embedUrl:"http://imgur.com/<%= remote_id %>/embed",html:'<iframe allowfullscreen="true" scrolling="no" id="imgur-embed-iframe-pub-<%= remote_id %>" class="imgur-embed-iframe-pub" style="height: 500px; width: 100%; border: 1px solid #000"></iframe>',height:500,width:540},gfycat:{name:"gfycat",regex:/https?:\/\/gfycat\.com(?:\/detail)?\/([a-zA-Z]+)/,embedUrl:"https://gfycat.com/ifr/<%= remote_id %>",html:`<iframe frameborder='0' scrolling='no' style="width:100%;" height='436' allowfullscreen ></iframe>`,height:436,width:580},"twitch-channel":{name:"twitch-channel",regex:/https?:\/\/www\.twitch\.tv\/([^\/\?\&]*)\/?$/,embedUrl:"https://player.twitch.tv/?channel=<%= remote_id %>",html:'<iframe frameborder="0" allowfullscreen="true" scrolling="no" height="366" style="width:100%;"></iframe>',height:366,width:600},"twitch-video":{name:"twitch-video",regex:/https?:\/\/www\.twitch\.tv\/(?:[^\/\?\&]*\/v|videos)\/([0-9]*)/,embedUrl:"https://player.twitch.tv/?video=v<%= remote_id %>",html:'<iframe frameborder="0" allowfullscreen="true" scrolling="no" height="366" style="width:100%;"></iframe>',height:366,width:600},"yandex-music-album":{name:"yandex-music-album",regex:/https?:\/\/music\.yandex\.ru\/album\/([0-9]*)\/?$/,embedUrl:"https://music.yandex.ru/iframe/#album/<%= remote_id %>/",html:'<iframe frameborder="0" style="border:none;width:540px;height:400px;" style="width:100%;" height="400"></iframe>',height:400,width:540},"yandex-music-track":{name:"yandex-music-track",regex:/https?:\/\/music\.yandex\.ru\/album\/([0-9]*)\/track\/([0-9]*)/,embedUrl:"https://music.yandex.ru/iframe/#track/<%= remote_id %>/",html:'<iframe frameborder="0" style="border:none;width:540px;height:100px;" style="width:100%;" height="100"></iframe>',height:100,width:540,id:n=>n.join("/")},"yandex-music-playlist":{name:"yandex-music-playlist",regex:/https?:\/\/music\.yandex\.ru\/users\/([^\/\?\&]*)\/playlists\/([0-9]*)/,embedUrl:"https://music.yandex.ru/iframe/#playlist/<%= remote_id %>/show/cover/description/",html:'<iframe frameborder="0" style="border:none;width:540px;height:400px;" width="540" height="400"></iframe>',height:400,width:540,id:n=>n.join("/")},codepen:{name:"codepen",regex:/https?:\/\/codepen\.io\/([^\/\?\&]*)\/pen\/([^\/\?\&]*)/,embedUrl:"https://codepen.io/<%= remote_id %>?height=300&theme-id=0&default-tab=css,result&embed-version=2",html:"<iframe height='300' scrolling='no' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'></iframe>",height:300,width:600,id:n=>n.join("/embed/")},instagram:{name:"instagram",regex:/https?:\/\/www\.instagram\.com\/p\/([^\/\?\&]+)\/?.*/,embedUrl:"https://www.instagram.com/p/<%= remote_id %>/embed",html:'<iframe width="400" height="505" style="margin: 0 auto;" frameborder="0" scrolling="no" allowtransparency="true"></iframe>',height:505,width:400},twitter:{name:"twitter",regex:/^https?:\/\/twitter\.com\/(?:#!\/)?(\w+)\/status(?:es)?\/(\d+?.*)?$/,embedUrl:"https://twitframe.com/show?url=https://twitter.com/<%= remote_id %>",html:'<iframe width="600" height="600" style="margin: 0 auto;" frameborder="0" scrolling="no" allowtransparency="true"></iframe>',height:300,width:600,id:n=>n.join("/status/")},pinterest:{name:"pinterest",regex:/https?:\/\/([^\/\?\&]*).pinterest.com\/pin\/([^\/\?\&]*)\/?$/,embedUrl:"https://assets.pinterest.com/ext/embed.html?id=<%= remote_id %>",html:"<iframe scrolling='no' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%; min-height: 400px; max-height: 1000px;'></iframe>",id:n=>n[1]},facebook:{name:"facebook",regex:/https?:\/\/www.facebook.com\/([^\/\?\&]*)\/(.*)/,embedUrl:"https://www.facebook.com/plugins/post.php?href=https://www.facebook.com/<%= remote_id %>&width=500",html:"<iframe scrolling='no' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%; min-height: 500px; max-height: 1000px;'></iframe>",id:n=>n.join("/")},aparat:{name:"aparat",regex:/(?:http[s]?:\/\/)?(?:www.)?aparat\.com\/v\/([^\/\?\&]+)\/?/,embedUrl:"https://www.aparat.com/video/video/embed/videohash/<%= remote_id %>/vt/frame",html:'<iframe width="600" height="300" style="margin: 0 auto;" frameborder="0" scrolling="no" allowtransparency="true"></iframe>',height:300,width:600},miro:{name:"miro",regex:/https:\/\/miro.com\/\S+(\S{12})\/(\S+)?/,embedUrl:"https://miro.com/app/live-embed/<%= remote_id %>",html:'<iframe width="700" height="500" style="margin: 0 auto;" allowFullScreen frameBorder="0" scrolling="no"></iframe>'},github:{name:"github",regex:/https?:\/\/gist.github.com\/([^\/\?\&]*)\/([^\/\?\&]*)/,embedUrl:'data:text/html;charset=utf-8,<head><base target="_blank" /></head><body><script src="https://gist.github.com/<%= remote_id %>" ><\/script></body>',html:'<iframe width="100%" height="350" frameborder="0" style="margin: 0 auto;"></iframe>',height:300,width:600,id:n=>`${n.join("/")}.js`}};return g});
